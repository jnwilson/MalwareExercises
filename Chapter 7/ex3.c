//#include <stdio.h>
//#include <stdlib.h>
#include <Windows.h>
//#include <wininet.h>
//#pragma comment(lib, "wininet.lib")
//#pragma comment(lib, "Advapi32.lib")


int main(int argc, char *argv[]){

	char *Warning = "WARNING_THIS_WILL_DESTROY_YOUR_MACHINE";
	char FileName[] = "path to kernel32.dll";
	char ExistingFileName[] = "Lab07-03.dll";

	HANDLE handle;
	LPVOID lpmap1;
	LPVOID lpmap2;

	if (argc != 2){
		return 0;
	}

	//check if 2nd arg matches else return
	if (strcmp(argv[2],Warning)){
		return 0;
	}

	//following win apis are called from register
	handle = CreateFileA(FileName, 0x80000000, 1, 0, 3, 0, 0); //push eax for 0's after a jnz, not sure why?

	handle = CreateFileMappingA(handle, 0, 2, 0, 0, 0);

	lpmap1 = MapViewOfFile(handle, 4, 0, 0, 0);

	handle = CreateFileA(ExistingFileName, 0x10000000, 1, 0, 3, 0, 0);

	if (handle == INVALID_HANDLE_VALUE){
		exit(0);
	}
	
	handle = CreateFileMappingA(handle, 0, 4, 0, 0, 0);

	if (handle == INVALID_HANDLE_VALUE){
		exit(0);
	}

	lpmap2 = MapViewOfFile(handle, FILE_MAP_ALL_ACCESS, 0, 0, 0);
	
	if (!lpmap2){
		exit(0);
	}

	//loc_401538
	//sub_401040(NULL, NULL, NULL); callx5
	//sub_401070(NULL, NULL, NULL);
	return 0;
}

void sub_401040(int eax, int edi, int esi){

	//sub_401000(NULL,NULL);
}

void sub_401000(int esi, int eax){

}

void sub_401070(int eax, int esi, int edx){

}